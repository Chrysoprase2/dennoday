<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Kosten eingeben</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      background-color: #9a8c98;
      height: 100vh;
      overflow: hidden;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .circle {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: silver;
      position: fixed;
      cursor: grab;
      box-shadow: 0 0 15px rgba(192,192,192,0.7);
      transition: background-color 0.3s ease;
      user-select: none;
      touch-action: none;
      z-index: 1;
    }
    .circle.active {
      background-color: white;
      cursor: grabbing;
    }
    .content-wrapper {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 400px;
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>

  <div class="circle" style="top: 50px; left: 50px;"></div>
  <div class="circle" style="top: 50px; right: 50px;"></div>
  <div class="circle" style="bottom: 50px; left: 50px;"></div>
  <div class="circle" style="bottom: 50px; right: 50px;"></div>

  <div class="content-wrapper">
    <h1 class="text-2xl font-bold text-center mb-4">ðŸ’° Kosten hinzufÃ¼gen</h1>
    
    <form id="kostenForm" class="space-y-4">
      <input type="text" id="name" placeholder="Name" required class="w-full p-2 border rounded">
      <input type="number" id="wert" placeholder="Betrag (â‚¬)" step="0.01" required class="w-full p-2 border rounded">
      <input type="text" id="grund" placeholder="Grund" required class="w-full p-2 border rounded">
      <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 rounded">HinzufÃ¼gen</button>
    </form>

    <button onclick="window.location.href='result.html'" class="w-full mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded">ðŸ“Š Zur Ãœbersicht</button>
  </div>

  <script>
    // save costs locally
    document.getElementById("kostenForm").addEventListener("submit", function(e) {
      e.preventDefault();
      
      let daten = JSON.parse(localStorage.getItem("kosten")) || [];
      daten.push({
        name: document.getElementById("name").value.trim(),
        wert: parseFloat(document.getElementById("wert").value),
        grund: document.getElementById("grund").value.trim()
      });
      localStorage.setItem("kosten", JSON.stringify(daten));

      alert("âœ… Kosten hinzugefÃ¼gt!");
      this.reset();
    });

    // drag and bounce circles
    const circles = document.querySelectorAll('.circle');

    circles.forEach((circle, index) => {
      let isDragging = false;
      let startX, startY;
      let origX, origY;
      let lastX, lastY;
      let velocityX = 0;
      let velocityY = 0;
      let animationFrame;

      // initial pos
      function getInitialPos(elem) {
        const rect = elem.getBoundingClientRect();
        return {x: rect.left, y: rect.top};
      }

      // store the base position for orbiting (initial position on load)
      const basePos = getInitialPos(circle);

      circle.style.left = basePos.x + 'px';
      circle.style.top = basePos.y + 'px';

      circle.addEventListener('mousedown', dragStart);
      circle.addEventListener('touchstart', dragStart, {passive: false});

      function dragStart(e) {
        e.preventDefault();
        isDragging = true;
        circle.classList.add('active');
        
        const rect = circle.getBoundingClientRect();
        origX = rect.left;
        origY = rect.top;

        if(e.type === 'mousedown') {
          startX = e.clientX;
          startY = e.clientY;
          window.addEventListener('mousemove', dragging);
          window.addEventListener('mouseup', dragEnd);
        } else if(e.type === 'touchstart') {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
          window.addEventListener('touchmove', dragging, {passive:false});
          window.addEventListener('touchend', dragEnd);
        }
        
        lastX = startX;
        lastY = startY;
        velocityX = 0;
        velocityY = 0;

        if(animationFrame) {
          cancelAnimationFrame(animationFrame);
        }
      }

      function dragging(e) {
        if (!isDragging) return;
        e.preventDefault();

        let clientX, clientY;
        if(e.type === 'mousemove') {
          clientX = e.clientX;
          clientY = e.clientY;
        } else if(e.type === 'touchmove') {
          clientX = e.touches[0].clientX;
          clientY = e.touches[0].clientY;
        }

        const dx = clientX - startX;
        const dy = clientY - startY;

        const newLeft = origX + dx;
        const newTop = origY + dy;

        circle.style.left = newLeft + 'px';
        circle.style.top = newTop + 'px';

        velocityX = clientX - lastX;
        velocityY = clientY - lastY;
        lastX = clientX;
        lastY = clientY;
      }

      function dragEnd(e) {
        if (!isDragging) return;
        isDragging = false;
        circle.classList.remove('active');

        window.removeEventListener('mousemove', dragging);
        window.removeEventListener('mouseup', dragEnd);
        window.removeEventListener('touchmove', dragging);
        window.removeEventListener('touchend', dragEnd);

        bounce(velocityX, velocityY);
      }

      function bounce(vx, vy) {
        let posX = parseFloat(circle.style.left);
        let posY = parseFloat(circle.style.top);

        let amplitudeX = vx * 5;
        let amplitudeY = vy * 5;

        let time = 0;
        const damping = 0.9;
        const orbitRadius = 15;

        function animate() {
          // bounce amplitude decays over time, but orbit continues forever
          const decay = Math.pow(damping, time);

          // Bounce offsets (go to zero)
          const deltaX = amplitudeX * Math.cos(time * 0.3) * decay;
          const deltaY = amplitudeY * Math.cos(time * 0.3) * decay;

          // Orbit angle increases indefinitely (loops)
          const orbitAngle = time * 0.05; // speed of orbit, adjust as needed

          const orbitOffsetX = orbitRadius * Math.cos(orbitAngle);
          const orbitOffsetY = orbitRadius * Math.sin(orbitAngle);

          circle.style.left = (posX + deltaX + orbitOffsetX) + 'px';
          circle.style.top = (posY + deltaY + orbitOffsetY) + 'px';

          time++;
          animationFrame = requestAnimationFrame(animate);
        }

        animate();
      }

      // different starting pos for orbits
      (function startOrbit() {
        let time = 0;
        const orbitRadius = 15;
        const phaseOffset = (Math.PI / 2) * index; // 90Â° steps offset
        animationFrame = requestAnimationFrame(function orbitAnim() {
          if (isDragging) {
            animationFrame = requestAnimationFrame(orbitAnim);
            return; // skip orbiting while dragging
          }
          const orbitAngle = time * 0.05 + phaseOffset;
          const orbitOffsetX = orbitRadius * Math.cos(orbitAngle);
          const orbitOffsetY = orbitRadius * Math.sin(orbitAngle);
          circle.style.left = (basePos.x + orbitOffsetX) + 'px';
          circle.style.top = (basePos.y + orbitOffsetY) + 'px';
          time++;
          animationFrame = requestAnimationFrame(orbitAnim);
        });
      })();

    });
  </script>

</body>
</html>